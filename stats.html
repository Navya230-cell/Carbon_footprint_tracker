<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Emission Statistics</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/stats.css') }}">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

  <header>
    <h1>üåç Emission Statistics</h1>
  </header>

  <nav>
    <a href="{{ url_for('home') }}">Home</a>
    <a href="{{ url_for('dashboard') }}">Dashboard</a>
    <a href="{{ url_for('stats') }}" class="active">Statistics</a>
    <a href="{{ url_for('solutions') }}">Solutions</a>
    <a href="{{ url_for('logout') }}">Logout</a>
  </nav>

  <section class="stats-section">
    <h2>1Ô∏è‚É£ Category-Wise Emission</h2>
    <div class="chart-container">
      <canvas id="categoryChart"></canvas>
    </div>

    <h2>2Ô∏è‚É£ Daily Emission Trend</h2>
    <div class="chart-container">
      <canvas id="dailyChart"></canvas>
    </div>

    <h2>3Ô∏è‚É£ Top 5 Emission Activities</h2>
    <div class="chart-container">
      <canvas id="topChart"></canvas>
    </div>

    <h2>4Ô∏è‚É£ You vs Average User (per Category)</h2>
    <div class="chart-container">
      <canvas id="compareChart"></canvas>
    </div>

    <div class="rank-section">
      <h3>üèÜ Your Rank: {{ rank }} / {{ total_users }} Users</h3>
    </div>

    <a href="{{ url_for('dashboard') }}" class="back-btn">‚¨Ö Back to Dashboard</a>
  </section>

  <footer>
    ¬© 2025 Carbon Footprint Tracker | Building a Greener Future üå±
  </footer>

  <script>
    const categories = JSON.parse('{{ categories | tojson | safe }}');
  const emissions = JSON.parse('{{ emissions | tojson | safe }}');
  const dates = JSON.parse('{{ dates | tojson | safe }}');
  const daily_emissions = JSON.parse('{{ daily_emissions | tojson | safe }}');
  const top_activities = JSON.parse('{{ top_activities | tojson | safe }}');
  const top_emissions = JSON.parse('{{ top_emissions | tojson | safe }}');
  const compare_categories = JSON.parse('{{ compare_categories | tojson | safe }}');
  const user_emission = JSON.parse('{{ user_emission | tojson | safe }}');
  const avg_emission = JSON.parse('{{ avg_emission | tojson | safe }}');

    
    new Chart(document.getElementById('categoryChart'), {
      type: 'pie',
      data: {
        labels: categories,
        datasets: [{
          label: 'Total Emission (kg CO‚ÇÇ)',
          data: emissions,
          backgroundColor: ['#43a047', '#ffc107', '#e53935', '#2196f3', '#9c27b0', '#8bc34a']
        }]
      },
      options: { responsive: true }
    });

    
    new Chart(document.getElementById('dailyChart'), {
      type: 'line',
      data: {
        labels: dates,
        datasets: [{
          label: 'Daily CO‚ÇÇ Emission (kg)',
          data: daily_emissions,
          borderColor: '#388e3c',
          backgroundColor: 'rgba(56, 142, 60, 0.3)',
          fill: true,
          tension: 0.2
        }]
      },
      options: { responsive: true }
    });

    
    new Chart(document.getElementById('topChart'), {
      type: 'bar',
      data: {
        labels: top_activities,
        datasets: [{
          label: 'Emission (kg CO‚ÇÇ)',
          data: top_emissions,
          backgroundColor: '#ff7043'
        }]
      },
      options: {
        responsive: true,
        indexAxis: 'y',
        scales: { x: { beginAtZero: true } }
      }
    });

    
    new Chart(document.getElementById('compareChart'), {
      type: 'bar',
      data: {
        labels: compare_categories,
        datasets: [
          {
            label: 'You',
            data: user_emission,
            backgroundColor: '#4caf50'
          },
          {
            label: 'Average User',
            data: avg_emission,
            backgroundColor: '#9e9e9e'
          }
        ]
      },
      options: {
        responsive: true,
        scales: { y: { beginAtZero: true } },
        plugins: { legend: { position: 'bottom' } }
      }
    });
  </script>

</body>
</html>
